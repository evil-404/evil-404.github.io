<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">


  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=">


  <link rel="mask-icon" href="/images/logo.svg?v=" color="#222">





  <meta name="keywords" content="snort," />





  <link rel="alternate" href="/atom.xml" title="Evil-404" type="application/atom+xml" />






<meta name="description" content="0x01 关于Snort123业界相对比较出名年头也比较久的一款基于网络的开源入侵检测工具不过,比较适合中小型网络 [在流量不是非常大的情况下还是很不错的选择],规则配置灵活,实战适用性相对较好只是,实在不知道为什么要弄一头猪做logo,这文化差异大的有点儿着实让人无法理解 :) 0x02 理解snort的最基本的工作流程123内网中的数据 -&amp;gt; 数据嗅探[让内网中其它机器上的数据流过自己]">
<meta name="keywords" content="snort">
<meta property="og:type" content="article">
<meta property="og:title" content="入侵检测学习 Snort [一]">
<meta property="og:url" content="https://evil-404.github.io/snortpentest.html">
<meta property="og:site_name" content="Evil-404">
<meta property="og:description" content="0x01 关于Snort123业界相对比较出名年头也比较久的一款基于网络的开源入侵检测工具不过,比较适合中小型网络 [在流量不是非常大的情况下还是很不错的选择],规则配置灵活,实战适用性相对较好只是,实在不知道为什么要弄一头猪做logo,这文化差异大的有点儿着实让人无法理解 :) 0x02 理解snort的最基本的工作流程123内网中的数据 -&amp;gt; 数据嗅探[让内网中其它机器上的数据流过自己]">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://evil-404.github.io/img/snort.png">
<meta property="og:updated_time" content="2017-11-21T02:06:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="入侵检测学习 Snort [一]">
<meta name="twitter:description" content="0x01 关于Snort123业界相对比较出名年头也比较久的一款基于网络的开源入侵检测工具不过,比较适合中小型网络 [在流量不是非常大的情况下还是很不错的选择],规则配置灵活,实战适用性相对较好只是,实在不知道为什么要弄一头猪做logo,这文化差异大的有点儿着实让人无法理解 :) 0x02 理解snort的最基本的工作流程123内网中的数据 -&amp;gt; 数据嗅探[让内网中其它机器上的数据流过自己]">
<meta name="twitter:image" content="https://evil-404.github.io/img/snort.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'LPBE9XRFRL',
      apiKey: '246a90c6ff16be5d5708e201cf6d7158',
      indexName: 'API',
      hits: {"per_page":10},
      labels: {"input_placeholder":"输入关键字搜索","hits_empty":"“没有找到与 ${query} 相关的内容”","hits_stats":"“搜索到 ${hits} 条相关记录，共耗时 ${time} ms”"}
    }
  };
</script>



  <link rel="canonical" href="https://evil-404.github.io/snortpentest.html"/>





  <title>入侵检测学习 Snort [一] | Evil-404</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Evil-404</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">专注于 APT 攻防研究,致力于高质量实用干货分享</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-nav">
          <a href="/nav/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            导航
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://evil-404.github.io/snortpentest.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VK">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/baeae4e0ly1fsu7yzju7lj20af0a0wej.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Evil-404">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">入侵检测学习 Snort [一]</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-22T12:31:04+08:00">
                2017-09-22
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2017-11-21T10:06:36+08:00">
                2017-11-21
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            

            

              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/snort/" itemprop="url" rel="index">
                    <span itemprop="name">snort</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,139
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><br><br>0x01 关于Snort<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">业界相对比较出名年头也比较久的一款基于网络的开源入侵检测工具</span><br><span class="line">不过,比较适合中小型网络 <span class="selector-attr">[在流量不是非常大的情况下还是很不错的选择]</span>,规则配置灵活,实战适用性相对较好</span><br><span class="line">只是,实在不知道为什么要弄一头猪做<span class="selector-tag">logo</span>,这文化差异大的有点儿着实让人无法理解 <span class="selector-pseudo">:)</span></span><br></pre></td></tr></table></figure></p>
<p>0x02 理解snort的最基本的工作流程<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">内网中的数据 -&gt; 数据嗅探[让内网中其它机器上的数据流过自己] -&gt; 进行各种预处理[防止数据逃逸] -&gt; 规则检测引擎 -&gt; 处理报警/日志 </span><br><span class="line">											    |		  |</span><br><span class="line">										      匹配规则库	  存到数据库或者写到日志文件中</span><br></pre></td></tr></table></figure></p>
<p>0x03 模块具体作用简介<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数据包嗅探,让其它机器上的指定数据包都经过自己,以便snort分析数据,同样,用的也是libpcap库,包括在其它很多linux平台嗅探工具你都能看到它的身影</span><br><span class="line">预处理,包重组预处理器,主要是为了防止攻击包被拆分逃避Snort的检测,另一个是协议编码预处理器,主要负责把数据包协议解码成一个统一的格式,再丢给检测模块,最后一个是协议异常检测预处器</span><br><span class="line">规则匹配检测,也就是当预处理把数据包丢过来以后,规则引擎会将这些数据包逐个和规则库进行匹配,一旦发现数据包内容与某条规则匹配,就丢给报警模块去处理</span><br><span class="line">报警/日志模块,规则引擎将数据丢给报警模块以后,报警模块会根据snort事先定义好的规则动作(alert,<span class="keyword">log</span><span class="params">...</span>)对其进行不同的处理(写到数据库或日志文件中)</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>0x04 Snrot 大致目录结构<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/etc/snort/</span><br><span class="line">├── attribute_table.dtd</span><br><span class="line">├── barnyard2<span class="selector-class">.conf</span>		将报警事先插到数据库中,里面主要定义了一些日志文件位置和数据库连接信息</span><br><span class="line">├── classification.config</span><br><span class="line">├── etc</span><br><span class="line">├── file_magic.conf</span><br><span class="line">├── gen-msg.map</span><br><span class="line">├── Makefile</span><br><span class="line">├── Makefile.am</span><br><span class="line">├── Makefile.<span class="keyword">in</span></span><br><span class="line">├── preproc_rules</span><br><span class="line">├── reference.config</span><br><span class="line">├── rules		snort规则库目录</span><br><span class="line">├── snort<span class="selector-class">.conf</span>		snort的主配置文件,关于snort工具本身的配置全在这里</span><br><span class="line">├── so_rules</span><br><span class="line">├── threshold.conf</span><br><span class="line">└── unicode.map</span><br></pre></td></tr></table></figure></p>
<p>0x05 环境准备,主要是所需的各类源码包及必要的依赖包<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">centos6</span><span class="selector-class">.9</span> <span class="selector-tag">x_64</span></span><br><span class="line"><span class="selector-tag">adodb519</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"><span class="selector-tag">barnyard2-1</span><span class="selector-class">.9</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"><span class="selector-tag">base-1</span><span class="selector-class">.4</span><span class="selector-class">.5</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"><span class="selector-tag">daq-2</span><span class="selector-class">.0</span><span class="selector-class">.4</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"><span class="selector-tag">idsctl</span><span class="selector-class">.zip</span></span><br><span class="line"><span class="selector-tag">libdnet-1</span><span class="selector-class">.12</span><span class="selector-class">.tgz</span></span><br><span class="line"><span class="selector-tag">libpcap-1</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"><span class="selector-tag">snort-2</span><span class="selector-class">.9</span><span class="selector-class">.7</span><span class="selector-class">.0</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"><span class="selector-tag">snortrules-snapshot-2970</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure></p>
<p>0x06 将要检测的内网卡[检测指定内网段]设为静态ip<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/sysconfig/network-scripts/ifcfg-eth0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">DEVICE</span>=eth3</span><br><span class="line"><span class="attr">HWADDR</span>=<span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:<span class="number">9</span>b:<span class="number">51</span>:ef</span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br><span class="line"><span class="attr">UUID</span>=effae4e2-c6e6-<span class="number">4</span>bf8-b9bd-f16ebc38b733</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">NM_CONTROLLED</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br><span class="line"><span class="attr">USERCTL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">PEERDNS</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPV6INIT</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">1.177</span></span><br><span class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="attr">DNS2</span>=<span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line"><span class="attr">DNS1</span>=<span class="number">114.114</span>.<span class="number">114.114</span></span><br></pre></td></tr></table></figure></p>
<p>0x07 先yum一个简易的lamp环境,主要是为了后期在前端展示报警事件方便,所以在这里就直接提前yum一个<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum install -y epel-release</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install -y gcc gcc-c++ flex bison zlib* libxml2 libpcap* pcre* tcpdump git libtool curl man make wget tree</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install -y mysql-server mysql-devel php-mysql php-adodb php-pear php-gd libtool php-imap php-ldap php-mbstring php-odbc php-pear php-xml php-pecl-apc httpd php php-mcrypt mcrypt libmcrypt libmcrypt-devel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig --level 235 mysqld on</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig --level 2345 httpd on</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vi /etc/httpd/conf/httpd.conf</span></span><br><span class="line">  ServerName localhost:80</span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/mysqld start</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/httpd start</span></span><br></pre></td></tr></table></figure></p>
<p>0x08 编译安装Snort<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tar xf libdnet-1.12.tgz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> libdnet-1.12</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./configure &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tar xf libpcap-1.0.0.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> libpcap-1.0.0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./configure &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tar xf daq-2.0.4.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> daq-2.0.4</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./configure &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tar xf snort-2.9.7.0.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> snort-2.9.7.0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./configure &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>
<p>0x09 配置snort,尽量让snort以一个普通用户权限起来<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mkdir /etc/snort</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cp /root/snort-2.9.7.0/etc/* /etc/snort/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls /etc/snort/ &amp;&amp; <span class="built_in">cd</span> /etc/snort/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tar xf /root/snortrules-snapshot-2970.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> touch /etc/snort/rules/white_list.rules /etc/snort/rules/black_list.rules</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> groupadd -g 5600 snort</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> useradd snort -u 5600 -d /var/<span class="built_in">log</span>/snort -s /sbin/nologin -c SNORT_IDS -g snort</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chown -R snort.snort /etc/snort/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chown -R snort.snort /var/<span class="built_in">log</span>/snort/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vi /etc/snort/snort.conf</span></span><br><span class="line">  var RULE_PATH /etc/snort/rules</span><br><span class="line">  var SO_RULE_PATH /etc/snort/so_rules</span><br><span class="line">  var PREPROC_RULE_PATH /etc/snort/preproc_rules</span><br><span class="line">  var WHITE_LIST_PATH /etc/snort/rules</span><br><span class="line">  var BLACK_LIST_PATH /etc/snort/rules</span><br><span class="line">  config logdir:/var/log/snort</span><br><span class="line">  output unified2: filename snort.log, limit 128</span><br><span class="line"><span class="meta">#</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/bin/snort /usr/bin/snort</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mkdir -p /usr/<span class="built_in">local</span>/lib/snort_dynamicrules</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chown -R snort.snort /usr/<span class="built_in">local</span>/lib/snort_dynamicrules/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chmod -R 755 /usr/<span class="built_in">local</span>/lib/snort_dynamicrules/</span></span><br></pre></td></tr></table></figure></p>
<p>0x10 先随便先添加一条规则,做下简单测试,规则的意思也很明显,对任意机器间来往的icmp进行报警<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vi <span class="regexp">/etc/</span>snort<span class="regexp">/rules/</span>local.rules</span><br><span class="line">  alert icmp <span class="keyword">any</span> <span class="keyword">any</span> -&gt; $HOME_NET <span class="keyword">any</span> (msg:<span class="string">"Ping test"</span>;sid:<span class="number">1000003</span>;rev:<span class="number">1</span>;)</span><br></pre></td></tr></table></figure></p>
<p>0x11 编译安装 barnyard2,顺带把表结构都导进去,等会儿要往里面插各种snort数据<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tar xf barnyard2-1.9.tar.gz -C /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysqladmin -u root password <span class="string">"admin"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql -uroot -p</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database snort;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> use snort;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create user <span class="string">'snort'</span>@<span class="string">'localhost'</span> identified by <span class="string">'admin'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant create,select,update,insert,delete on snort.* to snort@localhost identified by <span class="string">'admin'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> password <span class="keyword">for</span> snort@localhost=password(<span class="string">'admin'</span>);</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">source</span> /usr/<span class="built_in">local</span>/src/barnyard2-1.9/schemas/create_mysql;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show tables;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush privileges;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /usr/local/src/barnyard2-1.9/</span></span><br><span class="line"><span class="comment"># ./configure --with-mysql --with-mysql-libraries=/usr/lib64/mysql/ &amp;&amp; make &amp;&amp; make install</span></span><br><span class="line"><span class="comment"># mkdir /var/log/barnyard2</span></span><br><span class="line"><span class="comment"># touch /var/log/snort/barnyard2.waldo</span></span><br><span class="line"><span class="comment"># chown -R snort.snort /var/log/snort/barnyard2.waldo</span></span><br><span class="line"><span class="comment"># cp /usr/local/src/barnyard2-1.9/etc/barnyard2.conf /etc/snort/</span></span><br><span class="line"><span class="comment"># vi /etc/snort/barnyard2.conf </span></span><br><span class="line"> <span class="built_in"> config </span>logdir: /var/log/barnyard2</span><br><span class="line"> <span class="built_in"> config </span>hostname:  localhost</span><br><span class="line"> <span class="built_in"> config </span>interface: eth3</span><br><span class="line"> <span class="built_in"> config </span>waldo_file: /var/log/snort/barnyard2.waldo</span><br><span class="line">  output database: log, mysql, <span class="attribute">user</span>=snort <span class="attribute">password</span>=admin <span class="attribute">dbname</span>=snort <span class="attribute">host</span>=localhost</span><br></pre></td></tr></table></figure>
<p>0x12 启动snort,观察报警事件到底有没有被记录到数据库中<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> unzip idsctl.zip</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./idsctl</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./idsctl start</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> snort -q -u snort -g snort -c /etc/snort/snort.conf -i eth3 -D</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ping 192.168.1.1    随便ping,只是为了让snort捕获icmp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql -u snort -p -D snort -e <span class="string">"select count(*) from event"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ll /var/<span class="built_in">log</span>/snort/</span></span><br></pre></td></tr></table></figure></p>
<p>0x13 安装展示前端<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> pear upgrade pear</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pear channel-update pear.php.net</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pear install Image_Graph-alpha Image_Canvas-alpha Image_Color Numbers_Roman</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tar xf adodb519.tar.gz -C /var/www/html/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mv /var/www/html/adodb5/ /var/www/html/adodb</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tar xf base-1.4.5.tar.gz -C /var/www/html/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mv /var/www/html/base-1.4.5/ /var/www/html/base</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> vi /etc/php.ini</span></span><br><span class="line">  error_reporting = E_ALL &amp; ~E_NOTICE</span><br><span class="line"><span class="meta">#</span><span class="bash"> chown -R apache.apache /var/www/html/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chmod -R 755 /var/www/html/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pkill snort</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/mysqld restart</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/httpd restart</span></span><br></pre></td></tr></table></figure></p>
<p>0x14 访问前端页面进行简单配置,观察报警事件有没有被取出来,最后,实际部署成功的效果图如下<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.177</span><span class="regexp">/base/</span>base_main.php</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/snort.png" alt="&#39;&#39;"><br></p>
<p>0x15 本次的重点只是先把平台搞起来再说,后期的重点,还是会在下面这些点上,每个点涉及到的具体的东西可能又非常的多,不是简短几句话就能说明白的,长路漫漫,还是一点一点的稳扎稳打吧<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">根据自己的实际需求熟练编写Snort规则</span><br><span class="line">捕捉内网各种常规端口扫描特征,主要是针对各种常见的端口扫描工具标志,如,nmap,zmap,masscan,supersan...</span><br><span class="line">捕捉内网各类基础服务爆破特征,主要是针对hydra,medusa...</span><br><span class="line">捕捉内网web各种高危入侵特征[sql注入,xss劫持,表单爆破...]</span><br><span class="line">捕捉内网各类常规嗅探行为,如,最典型的arp...</span><br><span class="line">借助snort识别内网中的各类meterpreter的shell</span><br><span class="line">感知内网中的各种常规脱裤行为,如,pgsql,oracle,mysql,mssql...</span><br><span class="line">识别内网中的常规DDOS流量并灵活与iptables进行联动</span><br><span class="line">捕捉各类常规非加密tcp远控数据特征</span><br><span class="line">尝试识别捕捉各种常规流量重放攻击</span><br><span class="line">深入学习理解各类入侵检测对抗手段</span><br><span class="line">....</span><br></pre></td></tr></table></figure></p>
<p>0x16 小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;平台部署确实比较简单,基本也不存在什么技术含量,最终,关键还是看我们能不能用工具实际的干活,再牛逼的工具,不能很好的用起来,也只是摆设,这也可能是后期要重点慢慢啃的地方,还是那句话,实战为主,后期我们还会着重介绍另一款入侵检测系统,Suricata,个人觉得这个会更好,至于为什么更好,待续…</p>

      
    </div>
    
    
    


    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    klion
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://evil-404.github.io/snortpentest.html" title="入侵检测学习 Snort [一]">https://evil-404.github.io/snortpentest.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
</ul>



      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/snort/" rel="tag"><i class="fa fa-tag"></i>snort</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/mysql-mul-server.html" rel="next" title="一分钟部署 MySql 多实例">
                <i class="fa fa-chevron-left"></i> 一分钟部署 MySql 多实例
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/cobalt-strike.html" rel="prev" title="cobalt strike 快速上手 [ 一 ]">
                cobalt strike 快速上手 [ 一 ] <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://ws1.sinaimg.cn/large/baeae4e0ly1fsu7yzju7lj20af0a0wej.jpg"
                alt="VK" />
            
              <p class="site-author-name" itemprop="name">VK</p>
              <p class="site-description motion-element" itemprop="description">别惹我,我疯起来连自己都黑！</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">163</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">115</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">110</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Hack-with-Github/Awesome-Hacking" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:evil-404@protonmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/HackwithGithub" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                安全资讯
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.freebuf.com" title="FreeBuf" target="_blank">FreeBuf</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.secfree.com" title="指尖安全" target="_blank">指尖安全</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.sec-wiki.com" title="SecWiki" target="_blank">SecWiki</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xz.aliyun.com" title="先知社区" target="_blank">先知社区</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.4hou.com" title="嘶吼" target="_blank">嘶吼</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.anquanke.com" title="安全客" target="_blank">安全客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.aqniu.com" title="安全牛" target="_blank">安全牛</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.easyaq.com" title="E安全" target="_blank">E安全</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>
       
      

      

<div id="days"></div>
</script>
<script language="javascript">
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("07/01/2018 15:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>

  
    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">VK</span>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共312.4k字</span>
</div>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://evil-404.github.io/">Evil-404</a> 维护</div>



  <span class="post-meta-divider">|</span>






<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>



  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v="></script>

  <script type="text/javascript" src="/js/src/motion.js?v="></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v="></script>
<script type="text/javascript" src="/js/src/post-details.js?v="></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v="></script>



  


  




	





  





  












  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v="></script>



  

  

  

  
  

  

  

  

</body>
</html>

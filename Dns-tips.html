<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">


  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=">


  <link rel="mask-icon" href="/images/logo.svg?v=" color="#222">





  <meta name="keywords" content="DNS 深度理解," />





  <link rel="alternate" href="/atom.xml" title="Evil-404" type="application/atom+xml" />






<meta name="description" content="0x01 首先,我们先来简单回顾下DNS的基本解析流程, 比较简单,如下12345678910-&amp;gt; 以客户端浏览器访问 www.rootkit.org 域名为例,首先,它会去检查当前浏览器缓存,如果有,就直接响应,如果没有,就继续往下找  -&amp;gt; 接着,操作系统会去检查自己的host文件,如果从中没找到对应关系,会再到系统dns缓存中查,如果缓存中有,就直接返回该域名所对应的ip">
<meta name="keywords" content="DNS 深度理解">
<meta property="og:type" content="article">
<meta property="og:title" content="DNS 深度理解 [ 一 ]">
<meta property="og:url" content="https://evil-404.github.io/Dns-tips.html">
<meta property="og:site_name" content="Evil-404">
<meta property="og:description" content="0x01 首先,我们先来简单回顾下DNS的基本解析流程, 比较简单,如下12345678910-&amp;gt; 以客户端浏览器访问 www.rootkit.org 域名为例,首先,它会去检查当前浏览器缓存,如果有,就直接响应,如果没有,就继续往下找  -&amp;gt; 接着,操作系统会去检查自己的host文件,如果从中没找到对应关系,会再到系统dns缓存中查,如果缓存中有,就直接返回该域名所对应的ip">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://evil-404.github.io/img/dns101.jpg">
<meta property="og:image" content="https://evil-404.github.io/img/dns%20bind%20resolv.png">
<meta property="og:image" content="https://evil-404.github.io/img/dns%20reverse%20resolv.png">
<meta property="og:image" content="https://evil-404.github.io/img/dns%20MASTER%20MX.png">
<meta property="og:image" content="https://evil-404.github.io/img/dns%20master%20ptr.png">
<meta property="og:image" content="https://evil-404.github.io/img/dns%20zone%20vluln.png">
<meta property="og:updated_time" content="2017-12-30T12:47:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DNS 深度理解 [ 一 ]">
<meta name="twitter:description" content="0x01 首先,我们先来简单回顾下DNS的基本解析流程, 比较简单,如下12345678910-&amp;gt; 以客户端浏览器访问 www.rootkit.org 域名为例,首先,它会去检查当前浏览器缓存,如果有,就直接响应,如果没有,就继续往下找  -&amp;gt; 接着,操作系统会去检查自己的host文件,如果从中没找到对应关系,会再到系统dns缓存中查,如果缓存中有,就直接返回该域名所对应的ip">
<meta name="twitter:image" content="https://evil-404.github.io/img/dns101.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'LPBE9XRFRL',
      apiKey: '246a90c6ff16be5d5708e201cf6d7158',
      indexName: 'hexo',
      hits: {"per_page":10},
      labels: {"input_placeholder":"输入关键字搜索","hits_empty":"“没有找到与 ${query} 相关的内容”","hits_stats":"“搜索到 ${hits} 条相关记录，共耗时 ${time} ms”"}
    }
  };
</script>



  <link rel="canonical" href="https://evil-404.github.io/Dns-tips.html"/>





  <title>DNS 深度理解 [ 一 ] | Evil-404</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Evil-404</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">专注于 APT 攻防研究,致力于高质量实用干货分享</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://evil-404.github.io/Dns-tips.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VK">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ws1.sinaimg.cn/large/baeae4e0ly1fsu7yzju7lj20af0a0wej.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Evil-404">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">DNS 深度理解 [ 一 ]</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-12T04:09:17+08:00">
                2017-12-12
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2017-12-30T20:47:51+08:00">
                2017-12-30
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            

            

              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DNS-深度理解/" itemprop="url" rel="index">
                    <span itemprop="name">DNS 深度理解</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4,897
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  22
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>0x01 首先,我们先来简单回顾下<code>DNS的基本解析流程</code>, 比较简单,如下<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">&gt; 以客户端浏览器访问 www.rootkit.org 域名为例,首先,它会去检查当前浏览器缓存,如果有,就直接响应,如果没有,就继续往下找</span></span><br><span class="line"><span class="ruby">  -&gt; 接着,操作系统会去检查自己的host文件,如果从中没找到对应关系,会再到系统dns缓存中查,如果缓存中有,就直接返回该域名所对应的ip</span></span><br><span class="line"><span class="ruby">    -&gt; 如果缓存中没有,则会向我们事先设置好的dns服务器 [ 一般有两个, 主 &amp; 备 ] 去请求,即所谓的<span class="string">`递归查询`</span>,dns服务器首先会到自身解析数据库中去查</span></span><br><span class="line"><span class="ruby">      -&gt; 如果dns服务器在自己的解析库中也没找到,它就会自动帮我们向根发送询问请求</span></span><br><span class="line"><span class="ruby">	-&gt; 此时,根看到要请求的是org的后缀,就会把org所在的ns服务器告诉我们的dns</span></span><br><span class="line"><span class="ruby">	  -&gt; 然后,我们的dns服务器就会去请求org所在的ns服务器</span></span><br><span class="line"><span class="ruby">	    -&gt; 当请求到达org ns服务器时,org一看域名是在rootkit这个域下的,就会把rootkit所在的ns服务器再告诉我们的dns服务器</span></span><br><span class="line"><span class="ruby">	       -&gt; 再然后,我们的dns服务器就会去请求rootkit这个域的ns服务器</span></span><br><span class="line"><span class="ruby">		 -&gt; rootkit这个域的ns服务器一看是要访问www就直接找到了www对应的A记录的ip,并把它丢给我们的dns,上面逐个询问的过程,即 <span class="string">`迭代查询`</span></span></span><br><span class="line"><span class="ruby">		   -&gt; 最后,我们的dns再把最终解析到的这个ip丢给我们的客户端,然后客户端就直接拿着去访问了,如下,访问google.com时的简易流程图</span></span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p><img src="/img/dns101.jpg" alt=""><br>演示环境,此处暂以一主一从为例进行演示<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DnsMaster<span class="built_in">	ip </span>: 192.168.3.60	主<span class="built_in"> DNS </span>服务器</span><br><span class="line">DnsSlave<span class="built_in">	ip </span>: 192.168.3.61	从<span class="built_in"> DNS </span>服务器</span><br></pre></td></tr></table></figure></p>
<p>0x02 几种常见的 DNS 功用类型<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">主dns,主要负责实际的正反向域名解析</span><br><span class="line">从dns,主要从其它的主dns或者从dns中同步解析数据库,`即区域传送`,一般是通过序列号递增来判断主dns是否有更新</span><br><span class="line">缓存DNS服务器...</span><br><span class="line">转发器...</span><br></pre></td></tr></table></figure></p>
<p>0x03 理解DNS区域解析流向<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">正向 : FQDN -&gt; IP</span><br><span class="line">反向 :<span class="built_in"> IP </span>-&gt; FQDN</span><br><span class="line"></span><br><span class="line">FQDN 即 `完整合法域名`,如 `www.rootkit.org.` 最后面的`.`表示根,意思就是根下的org下的rootkit</span><br><span class="line">不管是正向还是反向区域都需要有一个单独的解析数据库去解析</span><br></pre></td></tr></table></figure></p>
<p>0x04 认识DNS中一些常见的资源记录类型,说到底就是用它们来标记某个主机类型<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A  	记录	FQDN -&gt; ipv4</span><br><span class="line">AAAA 	记录	FQDN -&gt; ipv6</span><br><span class="line">NS 	记录	标明当前区域的NS服务器是谁</span><br><span class="line">MX 	记录	标明当前域内谁是邮件服务器</span><br><span class="line">PTR 	记录<span class="built_in">	ip </span>-&gt; FQDN</span><br><span class="line">SOA 	记录	一个解析库有且只有一个SOA记录,且必须为解析库的第一条记录</span><br><span class="line">CNAME	记录	别名</span><br></pre></td></tr></table></figure></p>
<p>0x05 如何在区域配置文件中定义上述各种资源记录</p>
<p>记录定义标准格式,如下<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">name</span> TTL值[缓存时长可省] <span class="keyword">IN</span> 记录类型 值</span><br></pre></td></tr></table></figure></p>
<p>定义SOA记录,一般会配合DNS主从同步来用<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">admin.<span class="keyword">org. </span> IN SOA    ns.admin.<span class="keyword">org. </span>   admin.admin.<span class="keyword">org. </span>(</span><br><span class="line">			<span class="number">2017122309</span> 	   <span class="comment">; 序列号</span></span><br><span class="line">			<span class="number">2</span>H 		   <span class="comment">; 刷新时间</span></span><br><span class="line">			<span class="number">10</span>M		   <span class="comment">; 重试时长</span></span><br><span class="line">			<span class="number">1</span>W		   <span class="comment">; 过期时间</span></span><br><span class="line">			<span class="number">1</span>D		   <span class="comment">; 否定答案的TTL值</span></span><br><span class="line">			)</span><br></pre></td></tr></table></figure></p>
<p>定义NS记录,如果连续两条紧挨着的记录相同,后面一个的name可省略,另外NS记录需要在后续有一个对应的A记录<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="selector-class">.org</span>.	IN 	NS	ns1<span class="selector-class">.admin</span><span class="selector-class">.org</span>.</span><br><span class="line">admin<span class="selector-class">.org</span>.	IN 	NS	ns2<span class="selector-class">.admin</span><span class="selector-class">.org</span>.</span><br></pre></td></tr></table></figure></p>
<p>定义MX记录,注意,此记录有优先级,数字越小,优先级越高,同样,后面也需要指向一条A记录<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="selector-class">.org</span>.	IN 	MX	<span class="number">10</span>	mx1<span class="selector-class">.admin</span><span class="selector-class">.org</span>.</span><br><span class="line">admin<span class="selector-class">.org</span>.	IN 	MX	<span class="number">6</span>	mx2<span class="selector-class">.admin</span><span class="selector-class">.org</span>.</span><br></pre></td></tr></table></figure></p>
<p>定义A记录,注意,对于A记录,同一个name可以对应多个不同的ip,访问时会自动实现轮询的效果<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">www</span><span class="selector-class">.admin</span><span class="selector-class">.org</span>.	  <span class="selector-tag">IN</span>	<span class="selector-tag">A</span>		<span class="selector-tag">l</span><span class="selector-class">.2</span><span class="selector-class">.3</span><span class="selector-class">.4</span></span><br><span class="line"><span class="selector-tag">www</span><span class="selector-class">.admin</span><span class="selector-class">.org</span>.	  <span class="selector-tag">IN</span>	<span class="selector-tag">A</span>		<span class="selector-tag">l</span><span class="selector-class">.2</span><span class="selector-class">.3</span><span class="selector-class">.4</span></span><br><span class="line">*<span class="selector-class">.admin</span><span class="selector-class">.org</span>.	  <span class="selector-tag">IN</span>	<span class="selector-tag">A</span>		1<span class="selector-class">.2</span><span class="selector-class">.3</span><span class="selector-class">.4</span>		泛解析,用户输入不存在的域名是全部都解析到这个<span class="selector-tag">ip</span>上</span><br><span class="line"><span class="selector-tag">admin</span><span class="selector-class">.org</span>.	  <span class="selector-tag">IN</span>	<span class="selector-tag">A</span>		1<span class="selector-class">.2</span><span class="selector-class">.3</span><span class="selector-class">.4</span>		另外一种泛解析写法 <span class="selector-tag">admin</span><span class="selector-class">.org</span></span><br></pre></td></tr></table></figure></p>
<p>定义PTR记录,即反向区域解析,一定要注意,所有的ip地址必须反过来写,另外,都必须带上固有后缀<code>in-addr.arpa.</code><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4<span class="selector-class">.3</span><span class="selector-class">.2</span><span class="selector-class">.in-addr</span><span class="selector-class">.arpa</span>.	<span class="selector-tag">IN</span>	<span class="selector-tag">PTR</span>	<span class="selector-tag">www</span><span class="selector-class">.admin</span><span class="selector-class">.org</span>.</span><br></pre></td></tr></table></figure></p>
<p>定义CNAME记录,意思就是当访问web.admin.org.时就直接解析到<a href="http://www.admin.org" target="_blank" rel="noopener">www.admin.org</a>.<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web<span class="selector-class">.admin</span><span class="selector-class">.org</span>.	  IN	CNAME	www<span class="selector-class">.admin</span><span class="selector-class">.org</span>.</span><br></pre></td></tr></table></figure></p>
<p>0x06 关于一些常见 dns 解析测试工具的基本使用<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> dig -t 记录类型 要解析的域名 @用于解析该域名的dns服务器</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dig -t axfr 要解析的域名 @用于解析该域名的dns服务器	  全量区域同步,可用来测试`区域传送漏洞`</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dig +trace 要解析的域名  跟踪指定域名的详细解析过程</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nslookup	交互式查询</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> host -t 类型 要解析的域名 用于解析的dns服务器</span></span><br></pre></td></tr></table></figure></p>
<p>0x07 因为后续还要做DNS主从实时同步,所以这里就先从<code>配置正向区域解析</code>开始</p>
<p>开始安装主DNS,bind是核心包,bind-devel是bind核心库,utils是dns测试工具包,工具包里包含了一些常用工具,如,nslookup,dig,host,另外,此处暂以yum方式进行安装,当然,你也可以自行采用源码编译的方式进行安装,不过编译安装不太好的地方就是,有很多关键目录和配置文件没法自动生成,配置起来比较繁琐<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum install  <span class="built_in">bind</span>-utils <span class="built_in">bind</span> <span class="built_in">bind</span>-devel <span class="built_in">bind</span>-chroot -y</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpm -qa | grep <span class="built_in">bind</span></span></span><br></pre></td></tr></table></figure></p>
<p>配置主DNS的主配置文件<code>named.conf</code><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"># cat /var/named/named.ca	全球<span class="number">13</span>组根DNS服务器解析地址的存放位置</span><br><span class="line"># cp /etc/named.conf&#123;,.bak&#125;	先备份配置文件再编辑</span><br><span class="line"># &gt; /etc/named.conf		bind的主配置文件,主要提供全局配置</span><br><span class="line"># vi /etc/named.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局配置段,注意,dns工作在tcp/53和udp/53端口上,tcp/53一般主要用来进行区域同步,而udp/53主要用来负责正常的解析请求和响应</span></span><br><span class="line">options &#123;</span><br><span class="line">	version <span class="string">"1.1.1"</span>;</span><br><span class="line">	<span class="section">listen</span>-on port <span class="number">53</span> &#123; <span class="number">192.168</span><span class="number">.3</span><span class="number">.60</span>;<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>; &#125;;	<span class="comment">// 把dns端口监听在本地指定的ip上</span></span><br><span class="line">	directory <span class="string">"/var/named/chroot/etc/"</span>;		</span><br><span class="line">	pid-file <span class="string">"/var/named/chroot/var/run/named/named.pid"</span>;</span><br><span class="line">	allow-query &#123; any; &#125;;	<span class="comment">// 允许任意主机向我进行dns请求</span></span><br><span class="line">	Dump-file <span class="string">"/var/named/chroot/var/log/binddump.db"</span>;</span><br><span class="line">	Statistics-file <span class="string">"/var/named/chroot/var/log/named_stats"</span>;</span><br><span class="line">	zone-statistics yes;</span><br><span class="line">	memstatistics-file <span class="string">"log/mem_stats"</span>;</span><br><span class="line">	empty-zones-enable no;</span><br><span class="line">	forwarders &#123; <span class="number">114.114</span><span class="number">.114</span><span class="number">.114</span>;<span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>; &#125;;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置rndc通信共享秘钥</span></span><br><span class="line"><span class="type">key</span> <span class="string">"rndc-key"</span> &#123; </span><br><span class="line">	algorithm hmac-md5;</span><br><span class="line">	secret <span class="string">"Eqw4hClGExUWeDkKBX/pBg=="</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">controls &#123;</span><br><span class="line">	inet <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> port <span class="number">953</span></span><br><span class="line">	allow &#123; <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>; &#125; keys &#123; <span class="string">"rndc-key"</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bind日志配置区段	</span></span><br><span class="line">logging &#123;</span><br><span class="line">	channel warning &#123;</span><br><span class="line">		file <span class="string">"/var/named/chroot/var/log/dns_warning"</span> versions <span class="number">10</span> size <span class="number">10</span>m;</span><br><span class="line">		severity warning;</span><br><span class="line">		print-category yes;</span><br><span class="line">		print-severity yes;</span><br><span class="line">		print-time yes;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	channel general_dns &#123;</span><br><span class="line">		file <span class="string">"/var/named/chroot/var/log/dns_log"</span> versions <span class="number">10</span> size <span class="number">100</span>m;</span><br><span class="line">		severity info;</span><br><span class="line">		print-category yes;</span><br><span class="line">		print-severity yes;</span><br><span class="line">		print-time yes;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	category <span class="section">default</span> &#123;</span><br><span class="line">		warning;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	category queries &#123;</span><br><span class="line">		general_dns;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为了简化bind主配置文件,可以通过include的方式来引入区域文件</span></span><br><span class="line">include <span class="string">"/var/named/chroot/etc/view.conf"</span>;</span><br></pre></td></tr></table></figure></p>
<p>针对rndc 的简单配置,关于rndc其实就是个bind服务管理工具,可以通过它在本地或者直接远程来方便的对bind服务进行各种管理操作,如,重载,刷新缓存,关闭…默认工作在tcp/953端口上,比较危险,所以我们一般只让它监听在本地即可<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># vi /etc/rndc.<span class="type">key</span></span><br><span class="line"></span><br><span class="line"><span class="type">key</span> <span class="string">"rndc-key"</span> &#123;</span><br><span class="line">    algorithm hmac-md5;</span><br><span class="line">    secret <span class="string">"Eqw4hClGExUWeDkKBX/pBg=="</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># vi /etc/rndc.conf</span><br><span class="line"></span><br><span class="line"><span class="type">key</span> <span class="string">"rndc-key"</span> &#123;</span><br><span class="line">	algorithm hmac-md5;</span><br><span class="line">	secret <span class="string">"Eqw4hClGExUWeDkKBX/pBg=="</span>;</span><br><span class="line">&#125;;</span><br><span class="line">options &#123;</span><br><span class="line">	<span class="section">default</span>-<span class="type">key</span> <span class="string">"rndc-key"</span>;</span><br><span class="line">	<span class="section">default</span>-server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>;	<span class="comment">// 让它只监听在本地,禁止rndc远程连接,防止被利用</span></span><br><span class="line">	<span class="section">default</span>-port <span class="number">953</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>0x08 定义正向区域文件<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># vi /var/named/chroot/etc/view.conf</span><br><span class="line"></span><br><span class="line">view <span class="string">"MasterView"</span> &#123;</span><br><span class="line">	zone <span class="string">"admin.org"</span> &#123;</span><br><span class="line">		type    master;</span><br><span class="line">		file    <span class="string">"admin.org.zone"</span>;  <span class="comment">// 区域文件名,此处的文件名可以随意</span></span><br><span class="line">		allow-transfer &#123;	   <span class="comment">// 允许传送的主机,所谓的区域传送漏洞也就出在这里</span></span><br><span class="line">			<span class="number">192.168</span><span class="number">.3</span><span class="number">.61</span>;</span><br><span class="line">			<span class="comment">// any;		   // 如果此处设置为any,则允许任意主机来传送,这就是产生区域传送漏洞的根源</span></span><br><span class="line">					   <span class="comment">// 所以务必谨记,跟谁传送,就只写谁的ip</span></span><br><span class="line">		&#125;;</span><br><span class="line">		notify  yes;</span><br><span class="line">		also-notify &#123;</span><br><span class="line">			<span class="number">192.168</span><span class="number">.3</span><span class="number">.61</span>;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>0x09 定义正向区域文件,我们再来编写正向区域解析数据库,内部主要用于存放各种记录类型和宏,如下<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># vi /var/named/chroot/etc/admin.org.zone</span><br><span class="line"></span><br><span class="line">$TTL <span class="number">3600</span>   ; <span class="number">1</span>h</span><br><span class="line">@     IN SOA  ns1.admin.org. <span class="section">email</span>.admin.org (</span><br><span class="line">                        <span class="number">2003</span>       ; serial   <span class="comment">// 时刻谨记,每次如果是手工修改完解析库文件以后都要自增一下</span></span><br><span class="line">                        <span class="number">900</span>        ; refresh (<span class="number">15</span> minutes)</span><br><span class="line">                        <span class="number">600</span>        ; retry (<span class="number">10</span> minutes)</span><br><span class="line">                        <span class="number">86400</span>      ; expire (<span class="number">1</span> day)</span><br><span class="line">                        <span class="number">3600</span>       ; minimum (<span class="number">1</span> hour)</span><br><span class="line">                         )</span><br><span class="line">                IN      NS      ns1.admin.org.</span><br><span class="line">                IN      NS      ns2.admin.org.</span><br><span class="line">                IN      MX  <span class="number">10</span>  mx1.admin.org.</span><br><span class="line">                IN      MX  <span class="number">20</span>  mx2.admin.org.</span><br><span class="line">ns1		IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.3</span></span><br><span class="line">ns2		IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.61</span></span><br><span class="line">mx1		IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.4</span></span><br><span class="line">mx2		IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.5</span></span><br><span class="line">www		IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.6</span></span><br><span class="line">www		IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.3</span></span><br><span class="line">ftp		IN	CNAME	www.admin.org.</span><br><span class="line">*		IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.110</span>	<span class="comment">//此处,即为泛解析的两种书写方式</span></span><br><span class="line">admin.org.	IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.120</span></span><br><span class="line">cacti		IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.16</span></span><br><span class="line">zabbix		IN	A	<span class="number">192.168</span><span class="number">.3</span><span class="number">.18</span></span><br></pre></td></tr></table></figure></p>
<p>0x10 配置完正向区域解析库以后,我们就可以来重载服务,测试解析了<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> named-checkconf 		此命令会自动检查<span class="built_in">bind</span>主配置文件是否有语法错误</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> named-checkzone <span class="string">"admin.org"</span> admin.org.zone	检查指定区域解析库文件是否有错误配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ps -aux | grep named		我们看到<span class="built_in">bind</span>默认是用named用户来运行的,我们改下区域解析库文件的权限</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chmod 640 /var/named/chroot/etc/admin.org.zone</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ll /var/named/chroot/etc/admin.org.zone</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chown named.named /var/named/chroot/etc/admin.org.zone</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/named start	启动dns服务</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/named reload	重载dns服务</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rndc reload			在dns服务启动的情况下,也可使用rndc来重载区域解析库</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig named on		加入系统自启动</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> netstat -tulnp			看下端口有没正常起来</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dig -t A www.admin.org @192.168.3.60</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dig -t A mx2.admin.org @192.168.3.60</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/dns bind resolv.png" alt=""></p>
<p>0x11 在正向区域测试解析没有任何问题之后,我们再来看如何定义反向区域,注意,反向区域的ip地址要全部反写,即 <code>变化的区域不写,不变的区域反写</code>,此区域不需要MX和A记录,只需要PTR记录即可,另外,通常都是<code>先有正向解析再有反向解析</code><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168</span>.<span class="number">3</span><span class="selector-class">.x</span> =&gt; <span class="number">3.168</span>.<span class="number">192</span><span class="selector-class">.in-addr</span><span class="selector-class">.arpa</span></span><br><span class="line"><span class="number">192.168</span><span class="selector-class">.x</span><span class="selector-class">.x</span> =&gt; <span class="number">168.192</span><span class="selector-class">.in-addr</span><span class="selector-class">.arpa</span></span><br></pre></td></tr></table></figure></p>
<p>定义反向区域的方式很简单,先定义好反向区域文件<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># vi /<span class="keyword">var</span>/named/chroot/etc/<span class="keyword">view</span>.<span class="keyword">conf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">view</span> <span class="string">"MasterView"</span> &#123;</span><br><span class="line">    zone <span class="string">"admin.org"</span> <span class="keyword">IN</span> &#123;</span><br><span class="line">		<span class="keyword">type</span>    master;</span><br><span class="line">		<span class="keyword">file</span>    <span class="string">"admin.org.zone"</span>;</span><br><span class="line">		allow-transfer &#123;</span><br><span class="line">			192.168.3.61;</span><br><span class="line">		&#125;;</span><br><span class="line">		notify  yes;</span><br><span class="line">		also-notify &#123;</span><br><span class="line">			192.168.3.61;</span><br><span class="line">		&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    zone <span class="string">"3.168.192.in-addr.arpa"</span> <span class="keyword">IN</span> &#123; <span class="comment">// 一样要反写,此处就表示192.168.3.x这个网段</span></span><br><span class="line">		<span class="keyword">type</span>	master;</span><br><span class="line">		<span class="keyword">file</span>	<span class="string">"192.168.3.zone"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>再来定义反向区域解析库<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># vi /var/named/chroot/etc/<span class="number">192.168.3</span>.zone</span><br><span class="line"></span><br><span class="line"><span class="meta">$TTL</span> <span class="number">3600</span></span><br><span class="line"><span class="meta">$ORIGIN</span> <span class="number">3.168.192</span>.in-addr.arpa.</span><br><span class="line">@	<span class="keyword">IN</span> 	<span class="keyword">SOA</span>	ns1.admin.org.	login.admin.org. (</span><br><span class="line">					<span class="number">2001</span> // 时刻谨记,每次如果是手工修改完解析库文件以后都要自增一下</span><br><span class="line">					<span class="number">900</span></span><br><span class="line">					<span class="number">600</span></span><br><span class="line">					<span class="number">86400</span></span><br><span class="line">					<span class="number">3600</span></span><br><span class="line">					)</span><br><span class="line">	<span class="keyword">IN</span>	<span class="keyword">NS</span>		ns1.admin.org.</span><br><span class="line">	<span class="keyword">IN</span>	<span class="keyword">NS</span>		ns2.admin.org.</span><br><span class="line"><span class="number">6</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		www.admin.org.</span><br><span class="line"><span class="number">5</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		mx2.admin.org.</span><br><span class="line"><span class="number">4</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		mx1.admin.org.</span><br><span class="line"><span class="number">61</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		ns2.admin.org.	// 注意,这里必须要有一条ns记录指向我们后面的从DNS服务器</span><br><span class="line"><span class="number">3</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		ns1.admin.org.</span><br><span class="line"><span class="number">31</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		pop3.admin.org.</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> chmod 640 192.168.3.zone</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chown :named 192.168.3.zone</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> named-checkconf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> named-checkzone <span class="string">"3.168.192.in-addr.arpa"</span> 192.168.3.zone	检查zone配置文件中是否有错误</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ll /var/named/chroot/etc/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/named reload</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> netstat -tulnp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> host -t ptr 192.168.3.3 192.168.3.60</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dig -x 192.168.3.4 @192.168.3.60</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/dns reverse resolv.png" alt=""></p>
<p>0x12 当主DNS的正反向区域解析都没任何问题之后,我们开始来配置<code>主从DNS实时同步</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum install  <span class="built_in">bind</span>-utils <span class="built_in">bind</span> <span class="built_in">bind</span>-devel <span class="built_in">bind</span>-chroot -y</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpm -qa  <span class="built_in">bind</span>-utils <span class="built_in">bind</span> <span class="built_in">bind</span>-devel <span class="built_in">bind</span>-chroot</span></span><br></pre></td></tr></table></figure></p>
<p>开始配置从DNS,其实,在这里跟配置主DNS并没有太大区别,还是先按上面主DNS的配置方式来一遍<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &gt; /etc/named.conf</span></span><br><span class="line"><span class="comment"># vi /etc/named.conf</span></span><br><span class="line">options &#123;</span><br><span class="line">	version <span class="string">"1.1.1"</span>;</span><br><span class="line">	listen-on<span class="built_in"> port </span>53 &#123; 192.168.3.61; 127.0.0.1; &#125;;</span><br><span class="line">	directory <span class="string">"/var/named/chroot/etc/"</span>;</span><br><span class="line">	pid-file <span class="string">"/var/named/chroot/var/run/named/named.pid"</span>;</span><br><span class="line">	allow-query &#123; any; &#125;;</span><br><span class="line">	Dump-file <span class="string">"/var/named/chroot/var/log/binddump.db"</span>;</span><br><span class="line">	Statistics-file <span class="string">"/var/named/chroot/var/log/named_stats"</span>;</span><br><span class="line">	zone-statistics <span class="literal">yes</span>;</span><br><span class="line">	memstatistics-file <span class="string">"log/mem_stats"</span>;</span><br><span class="line">	empty-zones-<span class="builtin-name">enable</span> <span class="literal">no</span>;</span><br><span class="line">	forwarders &#123; 114.114.114.114;8.8.8.8; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">key <span class="string">"rndc-key"</span> &#123;</span><br><span class="line">	algorithm hmac-md5;</span><br><span class="line"><span class="built_in">	secret </span><span class="string">"Eqw4hClGExUWeDkKBX/pBg=="</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">controls &#123;</span><br><span class="line">	inet 127.0.0.1<span class="built_in"> port </span>953</span><br><span class="line">	allow &#123; 127.0.0.1; &#125; keys &#123; <span class="string">"rndc-key"</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">	</span><br><span class="line">logging &#123;</span><br><span class="line">	channel <span class="builtin-name">warning</span> &#123;</span><br><span class="line">		file <span class="string">"/var/named/chroot/var/log/dns_warning"</span> versions 10 size 10m;</span><br><span class="line">		severity warning;</span><br><span class="line">		print-category <span class="literal">yes</span>;</span><br><span class="line">		print-severity <span class="literal">yes</span>;</span><br><span class="line">		print-time <span class="literal">yes</span>;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	channel general_dns &#123;</span><br><span class="line">		file <span class="string">"/var/named/chroot/var/log/dns_log"</span> versions 10 size 100m;</span><br><span class="line">		severity info;</span><br><span class="line">		print-category <span class="literal">yes</span>;</span><br><span class="line">		print-severity <span class="literal">yes</span>;</span><br><span class="line">		print-time <span class="literal">yes</span>;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	category<span class="built_in"> default </span>&#123;</span><br><span class="line">		warning;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	category queries &#123;</span><br><span class="line">		general_dns;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br><span class="line">include <span class="string">"/var/named/chroot/etc/view.conf"</span>;</span><br></pre></td></tr></table></figure></p>
<p>配置rndc<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/rndc.key</span></span><br><span class="line"></span><br><span class="line">key <span class="string">"rndc-key"</span> &#123;</span><br><span class="line">    algorithm hmac-md5;</span><br><span class="line">   <span class="built_in"> secret </span><span class="string">"Eqw4hClGExUWeDkKBX/pBg=="</span>;</span><br><span class="line">&#125;;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># vi /etc/rndc.conf</span></span><br><span class="line"></span><br><span class="line">key <span class="string">"rndc-key"</span> &#123;</span><br><span class="line">	algorithm hmac-md5;</span><br><span class="line"><span class="built_in">	secret </span><span class="string">"Eqw4hClGExUWeDkKBX/pBg=="</span>;</span><br><span class="line">&#125;;</span><br><span class="line">options &#123;</span><br><span class="line">	default-key <span class="string">"rndc-key"</span>;</span><br><span class="line">	default-server 127.0.0.1;</span><br><span class="line">	default-port 953;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>0x13 接着,再来配置<code>主从DNS正向区域实时同步</code>,务必要记得在主DNS的正向解析库中一定要先有一条ns记录的ip是指向从DNS服务器的,不然同步通知是无法完成的,也就是说,一旦主DNS发生改变,它会通知所有的ns服务器进行更新,这样就可以实现实时正向区域同步的效果</p>
<p>对于从DNS的配置就非常简单了,只需要在从DNS上编辑区域文件,在里面配置好主DNS服务器的ip,设置好从DNS正向区域文件名,然后启动服务即可,如下<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># vi /<span class="keyword">var</span>/named/chroot/etc/<span class="keyword">view</span>.<span class="keyword">conf</span></span><br><span class="line"><span class="keyword">view</span> <span class="string">"SlaveView"</span> &#123;</span><br><span class="line">    zone <span class="string">"admin.org"</span> <span class="keyword">IN</span> &#123;</span><br><span class="line">	<span class="keyword">type</span>    slave;	<span class="comment">// 这里的类型要选择从服务器</span></span><br><span class="line">	masters &#123; 192.168.3.60; &#125;;	<span class="comment">// 指定主DNS服务器ip</span></span><br><span class="line">	<span class="keyword">file</span> <span class="string">"slave.admin.org.zone"</span>;	<span class="comment">// 指定从DNS正向区域解析库文件名,重启服务后它会自动同步过来,不用手工编辑</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>上面配置没问题以后,我们来重载服务试试<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ps -aux | grep named</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /var/ &amp;&amp; chown named.named named/	为了能让它自动创建解析库文件需要改先权限</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ll /var/named/chroot/etc</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/named start</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig named on</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cat /var/named/chroot/etc/slave.admin.org.zone	这个文件会在从dns重载之后自动被同步过来</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> netstat -tulnp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tail -f /var/<span class="built_in">log</span>/messages		其实,从日志中我们是可以清晰的看到整个同步过程的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dig -t MX admin.org @192.168.3.61 	同步完成后,我们可以直接用本机来进行解析测试</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/dns MASTER MX.png" alt=""></p>
<p>正向区域实时同步搞定之后,我们再来看看如何实现<code>反向区域实时主从同步</code>,还是要先在主DNS上的反向区域解析库中定义一条指向从DNS服务器的PTR记录,如下</p>
<p>首先,到主DNS服务器上去编辑反向区域解析库文件,添加一条指向从DNS服务器的PTR记录,具体如下<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># vi /var/named/chroot/etc/<span class="number">192.168.3</span>.zone</span><br><span class="line"></span><br><span class="line"><span class="meta">$TTL</span> <span class="number">3600</span></span><br><span class="line"><span class="meta">$ORIGIN</span> <span class="number">3.168.192</span>.in-addr.arpa.</span><br><span class="line">@	<span class="keyword">IN</span> 	<span class="keyword">SOA</span>	ns1.admin.org.	login.admin.org. (</span><br><span class="line">					<span class="number">2001</span>	// 时刻谨记,每次如果是手工修改完解析库文件以后都要自增一下</span><br><span class="line">					<span class="number">900</span></span><br><span class="line">					<span class="number">600</span></span><br><span class="line">					<span class="number">86400</span></span><br><span class="line">					<span class="number">3600</span></span><br><span class="line">					)</span><br><span class="line">	<span class="keyword">IN</span>	<span class="keyword">NS</span>		ns1.admin.org.</span><br><span class="line">	<span class="keyword">IN</span>	<span class="keyword">NS</span>		ns2.admin.org.</span><br><span class="line"><span class="number">6</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		www.admin.org.</span><br><span class="line"><span class="number">5</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		mx2.admin.org.</span><br><span class="line"><span class="number">4</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		mx1.admin.org.</span><br><span class="line"><span class="number">61</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		ns2.admin.org.	// 先在主DNS的反向区域解析库中添加一条指向从DNS的<span class="keyword">PTR</span>记录</span><br><span class="line"><span class="number">3</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		ns1.admin.org.</span><br><span class="line"><span class="number">31</span>	<span class="keyword">IN</span>	<span class="keyword">PTR</span>		pop3.admin.org.</span><br></pre></td></tr></table></figure></p>
<p>之后,再回到从DNS服务器上编辑区域配置文件,添加一个反向区域,跟正向区域同步一样,依然是指明主DNS服务器ip和从DNS反向区域解析库文件名,之后再重载服务,测试解析即可<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/named/chroot/etc/view.conf</span></span><br><span class="line"></span><br><span class="line">view <span class="string">"SlaveView"</span> &#123;</span><br><span class="line">    zone <span class="string">"admin.org"</span> <span class="keyword">IN</span> &#123;</span><br><span class="line">	<span class="built_in">	type </span>   slave;</span><br><span class="line">		masters &#123; 192.168.3.60; &#125;;</span><br><span class="line">		file <span class="string">"slave.admin.org.zone"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    zone <span class="string">"3.168.192.in-addr.arpa"</span> <span class="keyword">IN</span> &#123;</span><br><span class="line">	<span class="built_in">	type </span>slave;</span><br><span class="line">		masters &#123; 192.168.3.60;  &#125;;</span><br><span class="line">		file <span class="string">"192.168.3.zone"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># rndc reload</span><br><span class="line"># cat /var/named/chroot/etc/<span class="number">192.168</span><span class="number">.3</span>.zone	依然是在重载服务以后,该反向区域解析库文件会被自动同步过来</span><br><span class="line"># host -t ptr <span class="number">192.168</span><span class="number">.3</span><span class="number">.3</span> <span class="number">192.168</span><span class="number">.3</span><span class="number">.61</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/dns master ptr.png" alt=""></p>
<p>0x14 关于DNS自身的安全问题<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">配置错误,修复简单</span><br><span class="line">各类投毒污染攻击,需要多方配合,篇幅原因后续我们再详细说</span><br><span class="line"><span class="built_in">bind</span>工具自身的漏洞,时常注意官方发布的各类高危补丁,尤其是可以直接被远程利用的,而后进行适时修补或更新即可</span><br></pre></td></tr></table></figure></p>
<p>0x15 基于 DNS 的各类渗透技巧,其实说来,底层的原理非常简单,因为在一些脚本或者数据库中有很多那种可以直接用于发起DNS请求的函数,而我们就可以通过此来构造自己的各种攻击语句,然后再从解析log中提取执行结果<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">基于DNS <span class="keyword">log</span>的sql盲注,代码及命令执行<span class="params">...</span>后续有空接着说</span><br><span class="line">基于DNS隧道的各类远程,如,cobalt strike,关于这个,我们后续还会再单独抽出来详细说</span><br><span class="line">更多,待续<span class="params">...</span></span><br></pre></td></tr></table></figure></p>
<p>下面就是个简单的区域传送效果,不过像这种古董级漏洞,现在确实已经非常罕见了,属于敏感信息泄露的一种,容易直接被人看见内部的网络结构拓扑部署,祝大家好运吧 ^_^</p>
<p><img src="/img/dns zone vluln.png" alt=""><br><br></p>
<p>后话:<br>&nbsp;&nbsp;&nbsp;&nbsp;其实,像dns这种过于的基础服务,配置起来确实非常简单,不过,关键还是要能灵活应用,非常建议大家还是把绝大部分的时间都花在去深入理解dns的解析过程上,个人觉得那个才是真正的价值,因为所有的DNS高级应用场景,最底层全部都是基于这个,把最基础的东西搞通透以后,再去看各类高级应用就非常简单了,还是那句话<code>不管上层怎么变化,但万变不离其宗</code>,篇幅限制,此处仅仅也只是先带大家打个照面,更多高级应用,后续肯定还会有大量的篇幅说明,来日方长,我们待续……</p>

      
    </div>
    
    
    


    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    klion
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://evil-404.github.io/Dns-tips.html" title="DNS 深度理解 [ 一 ]">https://evil-404.github.io/Dns-tips.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
</ul>



      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/DNS-深度理解/" rel="tag"><i class="fa fa-tag"></i>DNS 深度理解</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/svn-config-sec.html" rel="next" title="不再让 `泄露` 拖你的后腿 [ subversion篇 ]">
                <i class="fa fa-chevron-left"></i> 不再让 `泄露` 拖你的后腿 [ subversion篇 ]
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/samba-sec.html" rel="prev" title="跨平台快速文件共享 Samba">
                跨平台快速文件共享 Samba <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://ws1.sinaimg.cn/large/baeae4e0ly1fsu7yzju7lj20af0a0wej.jpg"
                alt="VK" />
            
              <p class="site-author-name" itemprop="name">VK</p>
              <p class="site-description motion-element" itemprop="description">别惹我,我疯起来连自己都黑！</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">159</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">112</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">107</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Hack-with-Github/Awesome-Hacking" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:evil-404@protonmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/HackwithGithub" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                安全资讯
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.freebuf.com" title="FreeBuf" target="_blank">FreeBuf</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.secfree.com" title="指尖安全" target="_blank">指尖安全</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.sec-wiki.com" title="SecWiki" target="_blank">SecWiki</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xz.aliyun.com" title="先知社区" target="_blank">先知社区</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.4hou.com" title="嘶吼" target="_blank">嘶吼</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.anquanke.com" title="安全客" target="_blank">安全客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.aqniu.com" title="安全牛" target="_blank">安全牛</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.easyaq.com" title="E安全" target="_blank">E安全</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>
       
      

      

<div id="days"></div>
</script>
<script language="javascript">
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("07/01/2018 15:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>

  
    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">VK</span>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共298.9k字</span>
</div>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://evil-404.github.io/">Evil-404</a> 维护</div>



  <span class="post-meta-divider">|</span>






<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>



  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v="></script>

  <script type="text/javascript" src="/js/src/motion.js?v="></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v="></script>
<script type="text/javascript" src="/js/src/post-details.js?v="></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v="></script>



  


  




	





  





  












  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v="></script>



  

  

  

  
  

  

  

  

</body>
</html>
